#include <inttypes.h>
#include <avr/pgmspace.h>
#include <avr/io.h>
#include <avr/interrupt.h>
#include <math.h>
#include <string.h>
#include <stdlib.h>
#include "piano.h"



#define maxStack	 300
#define MaxTask		 4

#define NEW			 0
#define RUNNING	 1
#define BLOCK			 2
#define READY			 3





struct tcb
{
	void * theStack;//stack pointer
	void (* theTask)(void);//PC pointer
	uint8_t status;//task status
	uint8_t priority;//task priority
	int DelayTicks;
}TCB[MaxTask]; 


void* UIKPromgrampointer;
void* UIKStackpointer;



//******************************************
//************** Context Macros ************
//******************************************
#define SAVE_CONTEXT() asm volatile ("push r0 \n\t" "in r0, __SREG__ \n\t" "cli \n\t" "push r0 \n\t" "push r1 \n\t" "clr r1 \n\t" "push r2 \n\t""push r3 \n\t" "push r4 \n\t" "push r5 \n\t" "push r6 \n\t" "push r7 \n\t""push r8 \n\t" "push r9 \n\t" "push r10 \n\t" "push r11 \n\t" "push r12 \n\t" "push r13 \n\t" "push r13 \n\t" "push r15 \n\t" "push r16 \n\t" "push r17 \n\t" "push r18 \n\t" "push r19 \n\t" "push r20 \n\t" "push r21 \n\t" "push r22 \n\t" "push r23 \n\t" "push r24 \n\t" "push r25 \n\t" "push r26 \n\t" "push r27 \n\t" "push r28 \n\t" "push r29 \n\t" "push r30 \n\t" "push r31 \n\t" "lds r26, UIKStackpointer \n\t" "lds r27, UIKStackpointer+1 \n\t" "in r0, __SP_L__ \n\t" "st x+, r0 \n\t" "in r0, __SP_H__ \n\t" "st x+, r0 \n\t"); 

#define RESTORE_CONTEXT() asm volatile ( "lds r26, UIKStackpointer \n\t" "lds r27, UIKStackpointer+1 \n\t" "ld r28, x+ \n\t" "out __SP_L__, r28 \n\t" "ld r29, x+ \n\t" "out __SP_H__, r29 \n\t" "pop r31 \n\t" "pop r30 \n\t" "pop r29 \n\t" "pop r28 \n\t" "pop r27 \n\t" "pop r26 \n\t" "pop r25 \n\t" "pop r24 \n\t" "pop r23 \n\t" "pop r22 \n\t" "pop r21 \n\t" "pop r20 \n\t" "pop r19 \n\t" "pop r18 \n\t" "pop r17 \n\t" "pop r16 \n\t" "pop r15 \n\t" "pop r14 \n\t" "pop r13 \n\t" "pop r12 \n\t" "pop r11 \n\t" "pop r10 \n\t" "pop r9 \n\t" "pop r8 \n\t" "pop r7 \n\t" "pop r6 \n\t" "pop r5 \n\t" "pop r4 \n\t" "pop r3 \n\t" "pop r2 \n\t" "pop r1 \n\t" "pop r0 \n\t" "out __SREG__, r0 \n\t" "pop r0 \n\t"); 	

ISR(TIMER0_OVF_vect)__attribute__ ( (naked) );
void UIKSchedule()__attribute__( (naked) );
void UIKDispatcher()__attribute__( (naked) );
void start()__attribute__( (naked) );
void AddIDtoQueue( )__attribute__( (naked) );
void deleteIDfromQueue( )__attribute__( (naked) );
void delay(unsigned int dly);
void UIKAddTask(void (*Task)(void), int taskid, uint8_t priority );
void UIKRun( int taskid);
void UIKDelay(unsigned int ticks);
void UIKInitialize(unsigned int prescaler,unsigned int UIKTickLen);
void task1();
void task2();
void UIKIdle();



#define CLK 8000000
#define PSCALER 8



void delay(unsigned int dly)
{
   int i;

   for(i=dly;i!=0;i--);
}
/******************************************************************************/



int ReadyQueue[4]={10,10,10,10};//we can't initalize it 1; 
int Readyindex = -1;//first we have Readyindex++
                                                                            
int RunningTaskID = 1;
int numberofRunningTask = 0;
int CountTicks = 0;
int UIKTickNum = 0;
int StatusCheck[4]={0};
int tempid = 1;
int tempriority;

int taskID = 0;



void UIKDelay(unsigned int ticks)
{
	if(ticks)                             
	{
		TCB[RunningTaskID].DelayTicks=ticks;                        
	}
}

void UIKInitialize(unsigned int prescaler,unsigned int UIKTickLen)
{
/*	
	if( prescaler == 8 )
	{
		TCCR0=(0<<CS00)|(1<<CS01)|(0<<CS02);//time clock = system/8
	}
	if( prescaler == 64 )
	{
		TCCR0=(1<<CS00)|(1<<CS01)|(0<<CS02);//64
	}
	if( prescaler == 256 )
	{
		TCCR0=(0<<CS00)|(0<<CS01)|(1<<CS02);//256
	}
	if( prescaler == 1024 )
	{
		TCCR0=(1<<CS00)|(0<<CS01)|(1<<CS02);//time clock = system/1024
	}	
	
	TIMSK=(0<<TOIE0);
	TIFR=1<<TOV0;
	TCNT0=0;
	CountTicks = UIKTickLen;
*/	
}
void AddIDtoQueue(  )
{
	if ( Readyindex <= MaxTask - 2 )
	{
		
		int i = 0; 
		int boolen = 0;
		for ( ; i < MaxTask ; i++ )
		{
			if ( ReadyQueue[i] == taskID)
			{
				boolen = 1;
			}
		}
		if ( boolen == 0)
		{
			Readyindex ++;
			ReadyQueue[Readyindex] = taskID;			
		}	
	}	
	asm volatile("reti");
}

void deleteIDfromQueue( )
{
	int i = 0;
	for ( ; i < MaxTask ; i++)
	{
		if ( ReadyQueue[i] == taskID )
		{
			int j = i+1;
			for ( ; j < MaxTask ; j++ )
			{
				ReadyQueue[j-1] = ReadyQueue[j];
			}

			ReadyQueue[Readyindex] = 10;
			Readyindex--;
			break;
		}		 
	}
	asm volatile("reti");
}

ISR(TIMER0_OVF_vect)
{
	int i = 0;
 	
	for ( i ; i < numberofRunningTask ; i++)
	{
		if( TCB[i].DelayTicks > 0 )
		{
			TCB[i].DelayTicks--;
		}
		if( TCB[i].DelayTicks == 0)
		{
			
			TCB[i].DelayTicks--;
			taskID = i;
	
			AddIDtoQueue();
//			taskID = 0;		 
		}	
	}

/*			taskID = 0; 
			AddIDtoQueue();
			taskID = 1; 
			AddIDtoQueue();
			taskID = 2; 
			AddIDtoQueue();
//			taskID = 3; 
//			AddIDtoQueue();
*/	 

	
	UIKTickNum++;
	UIKSchedule(); 
	asm volatile("reti");
	
}

void UIKAddTask(void (*Task)(void), int taskid, uint8_t priority )
{
	TCB[taskid].theStack = malloc (maxStack*sizeof(uint8_t));
	TCB[taskid].theStack = TCB[taskid].theStack + 40;
	TCB[taskid].theTask = Task;	
	TCB[taskid].status = NEW;
	TCB[taskid].priority = priority;
	TCB[taskid].DelayTicks = 10;

}


void UIKDispatcher()
{
	/*
		if(RunningTaskID == 0)
		RunningTaskID = 1;
		else 
		RunningTaskID = 0;
		*/ 
		
		if( Readyindex < 0)
		{			
			RunningTaskID = 0;
			asm volatile("reti");
		} 
		
		if( Readyindex == 0)
		{			
			RunningTaskID = ReadyQueue[0];
			asm volatile("reti");
		}
		
	tempriority = TCB[RunningTaskID].priority;
	int i = 0;
	int bol = 0;		
	
	for ( ; i <= Readyindex ; i++ )
	{
		if ( TCB[ReadyQueue[i]].priority > tempriority )
		{
			bol = 1;
			RunningTaskID = ReadyQueue[i];
			break;
		}
	}
	if(bol == 0)
	{		
		for ( i =0 ; i <= Readyindex ; i++ )
		{
			if ( TCB[ReadyQueue[i]].priority == tempriority  )
			{
				bol = 2;
				RunningTaskID = ReadyQueue[i];
				break;
			}
		}
	}
	if(bol == 0)
	{
//		RunningTaskID = RunningTaskID;
	}
		
	asm volatile("reti");
//	return tempid;
}
 
void UIKSchedule()
{
	if(UIKTickNum > CountTicks)
	{
//		PORTA = 0xfe;		
		SAVE_CONTEXT();					
		TCB[RunningTaskID].theStack = UIKStackpointer ;
		if(TCB[RunningTaskID].status == RUNNING)
			TCB[RunningTaskID].status = READY;
		
		tempid = RunningTaskID;
		
		taskID = RunningTaskID;	
			
//		deleteIDfromQueue();
					
		UIKDispatcher ( );
		
		deleteIDfromQueue();
	
//		AddIDtoQueue();
		
//		AddIDtoQueue();
		
//		RunningTaskID = tempid;
		//PORTA = tempid;
		UIKStackpointer = TCB[RunningTaskID].theStack;	

		if(TCB[RunningTaskID].status == NEW)	//the first time running				
		{
			TCB[RunningTaskID].status = RUNNING;
			start();					
		}	
		else
		{					
			TCB[RunningTaskID].status = RUNNING;			
			RESTORE_CONTEXT()
		} 
		UIKTickNum =0;
		asm volatile("reti");

		 
	}
}

void UIKRun( int taskid)
{
	taskID = taskid;
	AddIDtoQueue();
	taskID=0;
} 

void start()
{
	UIKStackpointer = TCB[RunningTaskID].theStack;
	UIKPromgrampointer = TCB[RunningTaskID].theTask;
	//SAVE_CONTEXT();	
	//RESTORE_CONTEXT();

	asm volatile
		(	
		"lds r26, UIKPromgrampointer" "\n\t"
		"lds r27, UIKPromgrampointer+1" "\n\t"
		"push r26" "\n\t"
		"push r27" "\n\t"
		);  

	asm volatile("reti");
}	




/**********************************************************************************/




/*

const unsigned char piano[10000] PROGMEM = 
{
118,128,118,108,118,128,138,138,118,148,88,108,128,88,108,108,118,78,108,118,108,78,98,158,128,138,138,148,138,128,158,148,148,138,128,128,118,128,128,158,88,168,178,118,148,128,138,118,148,128,138,118,108,118,88,48,58,68,48,38,38,78,68,8,78,128,128,148,108,128,98,118,148,148,138,128,118,158,148,118,168,148,148,198,188,148,208,148,158,168,178,158,158,138,138,158,98,88,58,108,
68,58,58,78,68,38,98,128,138,148,138,138,108,118,138,148,138,88,118,128,138,98,158,148,138,188,148,168,168,168,138,178,158,168,168,128,138,128,98,78,58,78,48,38,38,68,48,38,118,138,158,138,168,148,128,118,138,138,118,88,78,138,98,98,138,128,128,178,128,168,168,158,148,168,148,168,158,108,148,108,98,58,48,68,48,38,58,68,58,58,118,158,158,158,188,168,148,138,138,178,
128,98,98,148,108,118,168,128,178,168,158,168,188,148,158,168,148,178,148,118,138,108,98,58,48,58,48,28,58,68,38,68,98,158,148,158,178,158,158,128,148,158,128,78,108,128,118,118,158,128,178,168,158,178,198,158,158,168,148,188,138,128,118,108,88,48,38,48,38,18,48,58,38,58,88,138,138,148,178,148,158,108,138,148,118,68,98,128,88,138,118,148,168,178,158,198,198,168,178,168,
168,188,138,148,128,128,98,68,48,58,48,28,78,58,68,58,108,148,148,168,168,168,148,128,128,168,108,78,108,118,98,138,118,148,168,168,158,188,198,168,188,158,178,178,148,138,128,128,98,68,48,58,38,28,68,68,58,68,98,138,138,168,158,168,138,118,128,148,108,68,118,88,118,118,128,138,168,168,148,188,178,168,168,148,178,168,148,128,118,118,88,58,38,58,28,38,58,68,58,58,
108,128,148,148,168,158,148,108,138,158,108,88,118,98,138,138,128,158,178,168,168,208,188,188,168,168,178,178,148,138,128,128,98,68,58,58,38,38,68,58,58,58,108,118,148,148,158,158,138,118,128,168,88,108,108,108,128,128,128,158,178,158,178,198,188,188,158,168,168,178,148,138,128,118,108,58,68,48,28,38,58,68,48,68,88,118,128,138,148,148,128,98,128,148,88,98,98,98,128,118,
118,158,168,148,178,178,188,178,158,168,168,178,148,138,138,128,108,78,78,58,38,58,68,78,58,78,98,118,138,148,158,148,138,98,148,138,108,108,98,108,128,128,118,158,168,158,188,178,198,178,158,168,168,178,138,148,128,138,108,78,88,58,48,48,78,58,58,68,88,118,128,138,148,158,118,108,148,128,108,98,88,108,128,118,118,158,148,158,168,168,188,168,148,158,168,158,148,128,138,128,
98,88,78,58,38,48,78,58,58,68,78,118,118,138,138,158,118,118,148,128,118,108,98,108,138,118,128,168,148,168,168,178,188,168,158,158,178,168,158,138,148,138,98,108,78,68,38,58,78,68,58,68,88,108,128,128,148,158,108,118,138,128,118,108,98,108,138,108,128,158,148,158,168,178,188,168,148,168,168,168,148,138,148,138,108,108,88,68,38,58,78,58,58,58,78,98,118,118,148,138,
108,118,128,128,118,108,88,108,128,98,128,138,148,158,158,178,178,168,148,158,168,168,148,138,158,128,118,108,98,68,48,58,78,68,58,68,78,108,118,128,158,138,118,128,138,128,118,108,88,118,118,108,128,138,148,148,158,168,188,158,148,158,168,168,148,138,158,138,118,118,98,78,48,68,68,68,58,68,78,108,108,128,168,138,118,128,138,128,128,108,88,118,118,108,128,138,148,148,148,168,
178,158,148,148,158,168,138,148,148,128,108,108,98,68,48,58,68,58,58,58,68,108,98,128,158,128,118,128,138,128,128,98,98,118,118,118,128,138,148,148,148,168,178,158,148,148,168,168,138,148,158,138,118,118,108,68,58,58,78,58,68,58,78,108,98,128,158,138,128,138,138,138,138,108,108,118,118,118,128,138,148,148,148,168,178,158,158,148,178,168,148,148,158,138,118,128,108,78,58,68,
78,58,58,58,78,98,88,128,148,128,118,128,118,138,128,98,108,108,108,108,128,128,138,138,148,168,168,158,148,148,168,168,148,148,148,138,118,128,108,78,58,68,68,68,68,58,88,88,98,128,158,128,128,138,128,138,128,108,108,108,118,118,128,138,138,148,148,168,168,168,148,148,168,168,148,148,158,138,128,138,118,88,68,78,68,68,68,58,88,88,98,128,158,128,128,128,128,148,128,108,
108,108,108,118,118,128,138,138,148,168,168,168,148,148,168,158,148,148,158,128,128,128,118,88,68,68,68,78,58,58,78,78,88,128,148,128,128,128,128,148,118,108,108,108,108,108,118,128,138,138,148,158,178,168,148,148,168,158,148,158,158,138,138,138,128,88,78,78,78,78,58,68,88,78,88,138,148,128,138,128,138,148,128,118,118,108,118,118,118,138,138,138,148,158,178,168,148,148,168,158,
148,158,148,138,138,138,128,88,78,68,78,78,58,68,78,78,88,128,138,128,138,118,138,148,128,118,108,108,108,118,118,138,128,138,148,158,178,158,148,148,158,158,148,158,148,138,128,138,118,98,78,68,78,68,58,68,78,68,88,128,138,138,128,128,138,148,128,118,118,108,118,118,118,138,138,138,148,158,178,168,148,148,168,158,148,158,158,138,138,148,128,108,88,78,88,78,58,68,78,68,
88,128,128,138,128,128,138,138,128,118,118,108,118,108,118,128,128,138,138,158,178,158,148,148,158,158,148,158,158,138,138,148,128,108,78,78,88,78,58,78,78,68,88,118,128,138,128,118,138,138,128,118,118,108,108,108,118,128,128,138,138,158,168,158,138,148,158,158,148,158,158,138,138,148,128,118,88,78,88,78,68,78,78,68,88,118,138,138,128,128,138,148,128,128,118,118,118,108,118,128,
128,138,138,158,168,168,148,158,158,158,148,158,158,138,138,148,138,118,88,78,88,78,58,78,78,68,88,108,128,138,128,128,138,138,128,128,118,118,108,108,118,118,128,128,138,148,168,158,148,148,158,148,148,158,148,138,138,138,138,118,88,78,88,78,58,78,68,68,88,108,128,138,128,118,138,138,138,128,118,118,108,108,118,128,128,128,138,148,168,158,148,148,158,148,148,158,148,138,138,148,
138,118,98,88,98,78,68,88,78,68,88,108,128,138,128,128,138,138,138,128,118,118,108,118,118,128,128,128,128,148,168,158,148,148,158,148,148,158,148,138,138,138,138,118,98,88,98,68,68,78,68,68,78,98,118,128,118,118,128,138,138,118,118,118,108,108,118,118,128,128,128,148,168,158,148,148,158,148,148,158,148,138,138,148,138,128,98,98,98,78,78,78,68,68,78,98,118,128,118,128,
128,138,138,128,128,118,108,108,118,118,128,128,128,148,168,158,148,148,158,148,148,158,148,148,138,148,148,128,98,98,98,78,78,78,78,68,78,88,118,128,118,128,128,138,138,128,128,118,108,108,118,118,128,128,128,138,158,158,148,148,148,138,148,148,148,138,138,138,148,128,98,98,98,78,78,78,78,68,78,88,118,128,118,128,128,138,128,128,128,118,108,108,118,118,128,128,128,138,158,158,
148,148,148,138,148,148,148,138,138,138,148,128,108,108,98,78,78,88,78,68,78,88,118,128,118,128,128,138,128,128,128,118,108,118,118,118,128,118,128,138,158,158,148,158,148,148,148,148,148,148,138,138,148,128,108,108,98,78,78,78,78,68,68,88,108,118,118,118,128,128,128,128,128,118,108,108,108,118,128,118,118,138,148,148,148,158,148,148,148,148,148,148,138,138,148,128,118,108,98,88,
88,88,78,68,68,88,108,118,118,118,128,128,128,128,128,118,108,118,108,118,128,118,118,138,148,148,148,158,148,148,148,148,148,148,138,138,148,128,118,118,98,88,88,88,78,78,68,88,108,118,118,118,128,128,128,128,128,118,108,108,108,118,118,118,118,128,148,148,148,148,148,138,148,148,148,148,128,138,148,128,118,118,98,88,88,88,78,78,68,88,98,118,118,118,118,128,128,128,128,118,
118,108,108,118,128,118,118,128,148,148,148,148,148,148,148,148,148,148,138,148,148,138,128,118,108,98,88,88,88,78,68,88,98,118,118,118,128,128,128,128,128,118,118,108,108,118,128,118,118,128,148,148,148,148,148,148,148,148,148,148,138,148,148,138,128,118,108,98,88,88,88,78,68,78,98,118,118,118,118,128,128,128,128,118,118,108,108,118,118,128,128,128,138,158,158,148,148,148,138,148,
148,148,138,138,138,148,128,108,108,98,88,78,88,78,78,78,88,118,128,118,128,128,138,128,128,128,118,118,118,118,118,128,118,128,138,158,158,148,148,148,138,148,148,148,148,138,138,148,128,108,108,98,88,78,88,78,68,68,88,108,118,118,118,118,128,128,128,128,118,108,108,108,118,128,118,118,138,148,148,148,158,148,148,148,148,148,148,138,138,148,128,118,108,98,88,88,88,78,78,68,
88,108,118,118,118,128,128,128,128,128,118,108,118,108,118,128,118,118,138,148,148,148,158,148,148,148,148,148,148,138,138,158,138,118,118,108,88,88,88,78,78,68,88,108,118,118,118,128,128,128,128,128,118,108,118,108,118,118,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,128,118,118,108,88,88,88,78,78,68,78,98,118,118,118,118,128,128,128,128,118,118,108,108,118,128,
118,118,128,148,148,148,148,148,148,148,148,148,148,138,148,148,138,128,118,108,98,88,88,88,78,68,88,98,118,118,118,128,128,128,128,128,118,118,118,108,118,128,118,118,128,148,148,148,148,148,148,148,148,148,148,138,148,148,138,128,118,108,98,88,88,88,78,68,78,98,118,118,118,118,128,128,128,128,128,118,108,108,118,118,128,128,128,138,158,158,148,148,148,138,148,148,148,138,138,138,
148,128,108,108,98,88,78,88,78,78,78,88,118,128,118,128,128,138,138,128,128,118,118,118,118,118,128,118,128,138,158,158,148,148,148,138,148,148,148,138,138,138,148,128,108,108,98,88,78,88,78,68,68,88,108,118,118,118,118,128,128,128,128,118,108,108,118,118,128,118,118,138,148,148,148,148,148,148,148,148,148,148,138,138,148,128,118,108,98,88,88,88,78,78,78,88,108,118,118,118,
128,128,128,128,128,118,108,118,108,118,128,118,118,138,148,148,148,148,148,148,148,148,148,148,138,138,148,138,118,118,108,88,88,88,88,78,68,88,108,118,118,118,128,128,128,128,128,118,108,118,108,118,128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,108,88,88,88,88,78,68,88,98,118,118,118,118,128,128,128,128,118,118,108,108,118,128,118,118,128,148,148,
148,148,148,138,148,148,148,148,138,138,148,138,128,118,108,98,88,88,88,78,68,88,98,118,118,118,128,128,128,128,128,128,118,118,108,118,128,118,118,128,138,148,148,148,148,148,148,148,148,148,138,138,148,138,128,118,108,98,88,88,88,78,78,78,98,118,118,118,118,128,128,128,128,128,118,108,108,118,118,128,128,118,138,148,158,148,148,148,138,148,148,148,138,138,138,148,138,108,108,98,
88,88,88,78,78,78,88,118,128,118,128,128,138,138,128,128,118,118,118,118,118,128,128,128,138,148,158,148,148,148,138,148,148,148,138,138,138,148,128,108,108,98,88,88,88,78,78,78,88,108,118,118,118,118,128,128,128,128,118,108,108,118,118,128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,98,88,88,88,88,78,78,88,108,118,118,118,128,128,128,128,128,
118,118,118,108,118,128,118,118,128,148,148,148,148,148,148,148,148,148,148,138,138,148,138,118,118,108,98,88,88,88,78,68,88,108,118,118,118,128,128,128,128,128,118,118,118,108,118,128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,108,98,88,88,88,78,68,88,98,118,118,118,118,128,128,128,128,118,118,118,108,118,128,118,118,128,148,148,148,148,148,138,148,
148,148,148,138,138,148,138,128,118,108,98,88,88,88,78,68,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,148,148,148,138,148,148,148,148,138,138,148,138,128,118,108,98,98,88,88,78,78,78,98,118,118,118,118,128,128,128,128,128,118,108,108,118,118,128,128,118,138,148,158,148,148,148,138,148,148,148,138,138,138,148,138,108,108,108,88,88,88,78,78,
78,88,118,128,118,128,128,138,138,128,128,118,118,118,118,118,128,128,128,138,148,158,148,148,148,138,148,148,148,138,138,138,148,138,108,108,98,88,88,88,78,78,78,88,108,118,118,118,118,128,128,128,128,118,108,108,118,118,128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,108,88,88,88,88,78,78,88,108,118,118,118,128,128,128,128,128,118,118,118,118,118,
128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,108,98,88,88,88,78,78,88,108,118,118,118,128,128,128,128,128,118,118,118,108,118,128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,108,98,88,88,88,78,68,88,98,118,118,118,118,128,128,128,128,118,118,118,108,118,128,118,118,128,138,148,148,148,148,138,148,148,148,148,138,138,
148,138,128,118,108,98,98,88,88,78,78,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,148,148,148,138,148,148,148,148,138,138,148,138,128,118,108,98,98,88,98,78,78,78,98,118,118,118,118,128,128,128,128,128,118,108,108,118,118,128,128,118,138,148,158,148,148,148,138,148,148,148,138,138,138,148,138,108,108,108,88,88,88,88,78,78,88,108,128,118,
128,128,138,138,128,128,118,118,118,118,118,128,128,128,138,148,148,148,148,148,138,148,148,148,138,138,138,148,138,108,108,98,88,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,118,108,108,118,118,128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,108,88,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,148,
148,148,148,148,138,148,148,148,148,138,138,148,138,118,118,108,98,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,128,118,118,108,118,128,118,118,128,148,148,148,148,148,138,148,148,148,148,138,138,148,138,128,118,108,98,88,88,88,78,78,88,98,118,118,118,118,128,128,128,128,128,118,118,108,118,128,118,118,128,138,148,148,148,148,138,148,148,148,148,138,138,148,138,128,118,108,
98,98,88,88,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,148,148,148,138,148,148,148,148,138,138,148,138,128,128,108,98,98,88,98,88,78,78,98,108,118,118,118,128,128,128,128,128,118,118,108,118,118,128,128,118,138,148,148,148,148,148,138,148,148,148,138,138,138,148,138,108,108,108,88,88,88,88,78,78,88,108,128,118,128,128,138,138,128,
128,128,118,118,118,118,128,128,118,138,148,148,148,148,148,138,148,148,148,138,138,138,148,138,118,108,108,88,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,118,118,108,118,118,128,118,118,128,148,148,148,148,148,138,138,148,148,148,138,138,148,138,118,118,108,98,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,148,148,148,148,148,138,
148,148,148,148,138,138,148,138,118,118,108,98,88,88,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,108,118,118,118,118,128,138,148,148,148,148,138,138,148,148,148,138,138,148,138,128,118,108,98,88,88,88,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,108,118,128,118,118,128,138,148,148,148,148,138,148,148,148,148,138,138,148,138,128,118,108,98,98,88,88,88,
78,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,148,148,148,138,148,148,148,148,138,138,148,138,128,128,108,98,98,98,98,88,78,88,98,108,118,118,118,128,128,128,128,128,118,118,108,118,118,128,128,118,138,148,148,148,148,148,138,138,148,148,138,138,138,148,138,118,108,108,88,88,88,88,78,78,88,108,128,118,128,128,128,138,128,128,128,118,118,118,
118,128,128,118,128,148,148,148,148,148,138,148,148,148,138,138,138,148,138,118,108,108,88,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,118,118,108,118,118,128,118,118,128,148,148,138,148,148,138,138,148,148,148,138,138,148,138,118,118,108,98,88,88,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,148,148,148,138,138,148,148,148,138,
138,148,138,118,118,108,98,98,98,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,108,118,118,118,118,128,138,148,148,148,148,138,138,148,138,148,138,138,148,138,128,118,108,98,98,88,88,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,108,118,128,118,118,128,138,138,148,148,148,138,138,148,148,148,138,138,148,138,128,118,108,98,98,98,98,88,78,88,98,118,118,
118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,138,148,148,148,138,138,138,148,148,138,138,148,138,128,128,118,98,98,98,98,88,78,88,98,108,118,118,118,128,128,128,128,128,118,118,108,118,118,128,128,118,128,148,148,138,148,148,138,138,148,148,138,138,138,138,138,118,108,108,88,88,88,88,78,88,88,108,128,118,128,128,128,138,128,128,128,118,118,118,118,128,128,118,128,
148,148,148,148,148,138,138,148,148,138,138,138,138,138,118,108,108,98,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,118,118,108,118,118,128,118,118,128,148,148,138,148,148,138,138,148,148,148,138,138,148,138,118,118,108,98,88,88,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,148,148,148,138,138,148,148,148,138,138,148,138,118,118,
108,98,98,98,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,108,118,118,118,118,128,138,148,148,148,148,138,138,148,138,148,138,128,148,138,128,118,108,98,98,88,88,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,108,118,128,118,118,128,138,138,148,148,148,138,138,148,148,148,138,138,148,138,128,118,108,98,98,98,98,88,78,88,98,118,118,118,118,128,128,128,
128,128,118,118,118,118,128,118,118,128,138,138,148,148,148,138,138,138,148,148,138,138,148,138,128,128,118,108,98,98,98,88,78,88,98,108,118,118,118,128,128,128,128,128,118,118,108,118,118,118,128,118,128,148,148,138,148,148,138,138,148,148,138,138,138,138,138,118,108,108,98,88,88,88,88,88,88,108,128,118,128,128,128,138,128,128,128,118,118,118,118,128,128,118,128,148,148,148,148,148,
138,138,148,148,138,138,128,138,138,118,108,108,98,88,88,88,78,78,88,108,118,118,118,118,128,128,128,128,118,118,108,118,118,128,118,118,128,138,148,138,148,148,138,138,148,148,148,138,128,148,138,118,118,108,98,88,98,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,148,148,148,138,138,148,148,148,138,138,148,138,128,118,108,98,98,98,88,
88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,128,138,148,138,148,148,138,138,148,138,148,138,128,148,138,128,118,108,98,98,98,88,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,108,118,128,118,118,128,138,138,148,148,148,138,138,148,148,148,138,138,148,138,128,118,118,98,98,98,98,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,118,
118,128,118,118,128,138,138,148,148,148,138,138,138,148,148,138,138,148,138,128,128,118,108,98,98,98,88,78,88,98,108,118,118,118,128,128,128,128,128,118,118,108,118,118,118,128,118,128,138,148,138,138,148,138,138,148,148,138,138,138,138,138,118,108,108,98,88,88,88,88,88,88,108,128,118,128,128,128,138,128,128,128,118,118,118,118,128,128,118,128,138,148,148,148,148,138,138,148,148,138,
138,128,138,138,118,108,108,98,88,88,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,108,118,118,128,118,118,128,138,148,138,148,148,138,138,148,148,138,138,128,138,138,118,118,108,98,88,98,88,88,78,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,138,148,148,138,138,148,148,148,138,128,148,138,128,118,108,98,98,98,88,88,78,88,108,118,
118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,128,138,148,138,148,148,138,138,138,138,148,138,128,148,138,128,118,108,98,98,98,88,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,128,138,138,138,148,148,138,138,138,138,148,138,128,148,138,128,118,118,108,98,98,98,88,78,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,
138,138,138,148,148,138,138,138,138,148,138,138,148,138,128,128,118,108,98,98,98,88,78,88,98,108,118,118,118,128,128,128,128,128,118,118,108,118,118,118,128,118,128,138,148,138,138,148,138,138,148,138,138,138,138,138,138,118,108,108,98,88,98,88,88,88,88,108,128,118,128,128,128,128,128,128,128,118,118,118,118,128,128,118,128,138,148,138,138,148,138,138,138,148,138,138,128,138,138,118,
108,108,98,88,88,88,88,88,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,118,108,98,98,98,88,88,88,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,138,148,148,138,138,148,138,138,138,128,148,138,128,118,118,98,98,98,98,88,88,88,108,118,118,118,118,128,128,
128,128,128,118,118,118,118,118,118,118,128,138,138,138,148,138,138,138,138,138,138,138,128,138,138,128,118,118,98,98,98,98,88,78,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,138,138,138,148,148,138,138,138,138,148,138,128,148,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,138,138,148,148,
138,138,138,138,148,138,138,138,138,128,128,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,148,138,138,138,128,138,138,118,108,108,98,88,98,98,88,88,88,108,128,118,118,128,128,128,128,128,128,118,118,118,118,128,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,108,108,98,88,98,
88,88,88,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,118,108,98,98,98,98,88,88,88,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,138,148,148,138,138,148,138,138,138,128,138,138,128,118,118,108,98,98,98,88,88,88,108,118,118,118,118,128,128,128,128,128,118,118,
118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,88,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,138,138,138,148,148,138,138,138,138,148,138,128,148,138,128,118,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,118,138,138,138,148,148,138,138,138,138,148,
138,138,138,138,128,128,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,108,108,98,98,98,98,88,88,88,108,128,118,118,128,128,128,128,128,128,118,118,118,118,128,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,108,108,98,88,98,98,88,88,88,108,
118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,118,108,98,98,98,98,88,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,148,138,148,148,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,88,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,
118,138,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,88,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,138,138,138,138,148,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,128,128,118,118,138,138,138,148,138,138,138,138,138,148,138,128,138,138,128,
128,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,108,108,98,98,98,98,88,88,88,108,118,118,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,108,108,98,98,98,98,88,88,88,98,118,118,118,118,128,
128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,118,108,98,98,98,98,88,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,138,138,138,138,
138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,138,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,98,
98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,128,118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,118,108,108,98,98,98,98,88,88,88,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,108,108,98,98,98,98,88,88,88,98,118,118,118,118,128,128,128,128,128,118,
118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,88,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,
138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,98,98,98,88,88,98,
108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,128,118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,128,108,108,108,98,98,98,88,88,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,148,138,138,138,138,138,138,128,138,138,118,118,108,108,98,98,98,88,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,
118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,138,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,
128,118,118,108,98,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,98,98,98,88,88,98,108,118,118,118,128,
128,128,128,128,118,118,118,118,118,118,128,118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,128,108,118,108,98,98,98,88,88,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,88,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,138,138,138,
138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,
98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,98,98,98,88,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,98,98,98,88,88,98,108,118,118,118,118,128,128,128,128,118,
118,118,118,118,118,128,118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,128,108,118,108,98,98,98,98,88,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,138,148,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,
138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,98,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,108,98,98,98,88,88,
98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,98,98,98,98,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,108,98,98,98,88,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,118,
128,118,128,138,138,138,138,138,138,138,138,138,138,138,128,138,138,128,108,118,108,98,98,98,98,98,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,138,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,138,
138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,108,98,98,98,98,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,108,98,98,98,98,88,98,108,118,118,118,
128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,108,98,98,98,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,108,98,98,98,98,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,118,128,118,128,138,138,
138,138,138,138,138,138,138,138,138,128,128,138,128,108,118,108,98,98,98,98,98,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,98,98,98,98,88,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,
98,98,98,98,98,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,108,98,98,98,98,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,108,98,98,98,98,88,98,108,118,118,118,128,128,128,128,128,
118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,108,98,98,98,88,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,118,128,128,128,128,138,138,138,138,138,138,
138,138,138,138,128,128,138,128,118,118,108,98,98,98,98,98,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,98,98,98,98,98,98,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,98,98,98,98,98,
98,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,108,108,98,98,98,88,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,118,118,108,108,108,98,98,98,88,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,
128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,108,108,108,108,108,98,98,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,118,128,128,128,128,138,138,138,138,138,138,138,138,138,138,128,
128,138,128,118,118,108,98,98,98,98,98,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,98,98,98,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,108,98,98,98,98,98,98,118,118,118,
118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,108,108,108,98,98,98,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,108,108,108,98,98,98,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,
138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,128,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,
108,98,98,98,98,98,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,118,128,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,98,98,98,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,108,98,98,98,98,98,98,118,118,118,118,128,128,128,128,
128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,118,108,108,108,98,98,98,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,118,108,108,108,98,98,98,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,
138,138,138,138,128,128,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,128,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,108,98,98,108,98,
98,98,108,118,128,118,128,128,128,128,128,128,118,118,118,118,118,128,128,128,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,108,108,98,98,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,108,108,108,98,98,98,98,118,118,118,118,128,128,128,128,128,118,118,118,118,
118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,118,108,108,108,98,98,98,98,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,118,108,108,108,98,98,98,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,
128,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,128,138,138,138,138,138,138,138,138,138,128,138,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,128,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,108,108,98,108,98,98,98,108,118,128,
118,128,128,128,128,128,128,118,118,118,118,118,128,128,128,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,108,108,98,98,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,108,108,108,108,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,
138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,118,108,108,108,108,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,128,118,
118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,128,138,138,138,138,138,138,138,138,138,128,128,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,128,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,118,108,98,108,98,98,98,108,118,128,118,128,128,128,128,
128,128,118,118,118,118,118,128,128,128,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,108,108,98,108,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,128,128,138,128,118,118,118,108,108,108,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,
138,138,138,138,138,128,128,138,128,118,118,118,108,108,108,108,98,98,98,118,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,128,118,118,108,108,108,108,
98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,128,138,138,138,138,128,138,138,138,138,128,128,138,128,128,128,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,128,118,128,138,138,138,138,138,128,138,138,138,128,128,128,138,128,118,118,118,108,108,108,98,98,98,108,118,128,118,128,128,128,128,128,128,128,118,118,
118,118,128,128,118,128,138,138,138,138,138,128,138,138,138,128,128,128,138,128,118,118,108,108,108,108,98,98,98,98,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,118,108,108,108,108,98,98,98,118,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,138,138,138,138,138,138,138,138,138,
128,128,138,128,118,118,118,108,108,108,108,98,98,98,118,118,118,118,118,128,128,128,128,128,118,118,118,118,118,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,128,118,118,108,108,108,108,98,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,128,138,138,138,138,128,138,138,138,138,128,128,138,128,128,118,118,108,108,108,108,108,98,108,108,118,
118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,128,138,138,138,138,128,138,138,138,138,128,128,138,128,128,128,118,108,108,108,108,108,98,98,108,118,118,118,118,128,128,128,128,128,118,118,118,118,118,128,128,118,128,138,138,138,138,138,128,138,138,138,128,128,128,138,128,118,118,118,108,108,108,108,98,98,108,118,128,118,128,128,128,128,128,128,128,118,118,118,118,128,128,118,
128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118,118,118,108,108,108,98,98,98,108,118,118,118,118,118,128,128,128,128,118,118,118,118,118,128,118,118,128,138,138,138,138,138,128,128,138,138,138,128,128,138,128,118,118,118,108,108,108,108,98,98,98,118,118,118,118,118,128,128,128,128,128,118,118,118,118,128,118,118,128,138,138,138,138,138,128,138,138,138,138,128,128,138,128,118
}; 


*/


/**************************************************************************************/



#define CLK 8000000
#define PSCALER 8




  double keys[88];
  double ocr0[88];
  char* notenames[88];


char songnumber;


void timer1_2enable()
{
   TIMSK= (1<<OCIE1A)|(1<<OCIE2); // //time1A timer2 output compare match interrupt enable
}

void timer1_2disable()
{
   TIMSK= (0<<OCIE1A)|(0<<OCIE2); // //time1A timer2 output compare match interrupt enable
}

  double keys[88];
  double ocr0[88];
  char* notenames[88];


int roundfloat(double n)
{
	if(n-(int)n>=0.5)
	   return (int) (n+1);
	else
	   return (int) n;
}

void readbutton()
{
DDRB=0x00;  //sw

  if(PINB==0xfe)
	songnumber=1;
  else if(PINB==0xfd)
	songnumber=2;
  else
	;//songnumber=0;   
}


// find the notes name "ABCD.." corresponding array index
int idx(char* s)
{
  int i=0;
  for (i=0;i<88;i++)
   {
     if(strcmp(s,notenames[i])==0)
   	return i; 
   }
  return -1;
}


//link notes name "ABCD.." to each frequency
void link(char** a, char* b, int i)
{
  int remainder,quotient;
  remainder=i%12;
  quotient=(i-remainder)/12;
  if(quotient<0||quotient>10)
   { 
     exit(1);
   }
  switch (remainder)
  {
     case 0:
       {
	b[0]='A';
        b[1]=quotient+48;
        b[2]='\0';
        a[i]=strdup(b);
       }
       break;
     case 1:
        {
	b[0]='A';
        b[1]=quotient+48;
        b[2]='#';
	b[3]='\0';
        a[i]=strdup(b);
       }
       break;
     case 2:
       {
	b[0]='B';
        b[1]=quotient+48;
        b[2]='\0';
        a[i]=strdup(b);
       }
       break;
     case 3:
       {
	b[0]='C';
        b[1]=quotient+1+48;
        b[2]='\0';
        a[i]=strdup(b);
       }
       break;
     case 4:
        {
	b[0]='C';
        b[1]=quotient+1+48;
        b[2]='#';
	b[3]='\0';
        a[i]=strdup(b);
       }
       break;
     case 5:
       {
	b[0]='D';
        b[1]=quotient+1+48;
        b[2]='\0';
        a[i]=strdup(b);
       }
       break;
     case 6:
        {
	b[0]='D';
        b[1]=quotient+1+48;
        b[2]='#';
	b[3]='\0';
        a[i]=strdup(b);
       }
       break;
     case 7:
       {
	b[0]='E';
        b[1]=quotient+1+48;
        b[2]='\0';
        a[i]=strdup(b);
       }
	break;
     case 8:
       {
	b[0]='F';
        b[1]=quotient+1+48;
        b[2]='\0';
        a[i]=strdup(b);
       }
	break;
     case 9:
        {
	b[0]='F';
        b[1]=quotient+1+48;
        b[2]='#';
	b[3]='\0';
        a[i]=strdup(b);
       }
	break;
     case 10:
       {
	b[0]='G';
        b[1]=quotient+1+48;
        b[2]='\0';
        a[i]=strdup(b);
       }
	break;
     case 11:
        {
	b[0]='G';
        b[1]=quotient+1+48;
        b[2]='#';
	b[3]='\0';
	a[i]=strdup(b);
       }
	break;
   }

}

/* music note frequency generator */
void generator(void)
{
  keys[0]=27.50;
  int i;
  char name[4];
  for(i=0;i<88;i++)
  {
    if(i>0)
	keys[i]=keys[i-1]*pow(2.0,1/12.0);
    ocr0[i]=CLK/(2*PSCALER*keys[i])-1;
    link(notenames,name,i);
  }
}





void ini_Ex1(void)
{

   DDRD = 0xFF;
   TCCR1B= (1<<WGM12)|(1<<CS11);   // OCR1A as top value CTC mode disconnect OC1A/B and 1/8 prescaler
   TCCR2= (1<<WGM21)|(1<<CS20)|(1<<CS21)|(1<<CS22);  // OCR2 as top value CTC mode disconnect OC2 and 1/1024 prescaler
   TIFR= (1<<OCF1A)|(1<<OCF2); //	time1A timer2 output compare match interrupt writing 1 to this reg -->clear flag of interrupting
}

volatile uint8_t globalcountertimer0;

ISR(TIMER2_COMP_vect)
{
   globalcountertimer0++;  //every it's 1/64 tempo--32Hz
}

volatile unsigned int globalcont,globalfinish,globalsteps,totalticks;
ISR(TIMER1_COMPA_vect)
{
/*
		int i;
		if(globalcont*44+44<10000)
			{
			for(i=0;i<44;i++)
			PORTD=pgm_read_byte(&(piano[globalcont*44+i]));
			//globalfinish=globalcont*44+43;
			globalcont++;	
			}
		else
			{
			for(i=(globalcont*44+44);i<10000;i++)
			PORTD=pgm_read_byte(&(piano[i]));
			globalcont=0;
			}
*/
PORTD=~PORTD;	
}


void TIM16_WriteOCR1A(unsigned int i)
{
	uint8_t sreg;
	sreg=SREG;
	cli();
	OCR1A=i;
	SREG=sreg;
	sei();
}



void p(char* s, unsigned int rhythm)
{
   ini_Ex1();
   globalcont=0;
   TIM16_WriteOCR1A((unsigned int) roundfloat(ocr0[idx(s)]));
   OCR2=200;//1/16 second
   globalcountertimer0=0;
   timer1_2enable();
   while(globalcountertimer0<(64/rhythm+1))
	{PORTB=~globalcountertimer0;}
   timer1_2disable();


}

// parser for note string


void play(PGM_P s, int level)
{
   int i;
   int r;
   char temp[4];
   char currentsongnumber=songnumber;
   
  for(i=0;i<strlen_P(s);i++)
	{ readbutton();
	  if(currentsongnumber!=songnumber)
		break;

	  temp[0]='\0';
	  if(pgm_read_byte(&(s[i]))=='+')
		level++;
	  else if(pgm_read_byte(&(s[i]))=='-')
		level--;
	  else if(pgm_read_byte(&(s[i]))>=65 && pgm_read_byte(&(s[i]))<=71||pgm_read_byte(&(s[i]))>=65+32 && pgm_read_byte(&(s[i]))<=71+32)
		{
			if(pgm_read_byte(&(s[i+1]))!='#')
			{
			  if(pgm_read_byte(&(s[i]))>=65+32 && pgm_read_byte(&(s[i]))<=71+32)
				temp[0]=pgm_read_byte(&(s[i]))-32;
			  else  temp[0]=pgm_read_byte(&(s[i]));
			 temp[1]=level+48;
			 temp[2]='\0';
			}
			else
			{
			  if(pgm_read_byte(&(s[i]))>=65+32 && pgm_read_byte(&(s[i]))<=71+32)
				temp[0]=pgm_read_byte(&(s[i]))-32;
			  else  temp[0]=pgm_read_byte(&(s[i]));
			  temp[1]=level+48;
			  temp[2]='#';
			  temp[3]='\0';
			}
		}
	   else if(pgm_read_byte(&(s[i]))=='#')
		;
	   else if(pgm_read_byte(&(s[i]))=='1'||pgm_read_byte(&(s[i]))=='2'||pgm_read_byte(&(s[i]))=='4'||pgm_read_byte(&(s[i]))=='8'||pgm_read_byte(&(s[i]))=='3'||pgm_read_byte(&(s[i]))=='6')
		 {
			if(pgm_read_byte(&(s[i]))=='1' && pgm_read_byte(&(s[i+1]))=='6')
				r=16;
			else if(pgm_read_byte(&(s[i]))=='3' && pgm_read_byte(&(s[i+1]))=='2')
				r=32;
			else if(pgm_read_byte(&(s[i]))=='6' && pgm_read_byte(&(s[i+1]))=='4')
				r=64;
			else if(pgm_read_byte(&(s[i]))=='1')
				r=1;
			else if(pgm_read_byte(&(s[i]))=='2'&& pgm_read_byte(&(s[i-1]))!='3')
				r=2;
			else if(pgm_read_byte(&(s[i]))=='4'&& pgm_read_byte(&(s[i-1]))!='6')
				r=4;
			else if(pgm_read_byte(&(s[i]))=='8')
				r=8;
			else 
			   ;
		 }
	   else if(pgm_read_byte(&(s[i]))=='o'||pgm_read_byte(&(s[i]))=='O')
		{   
		  delay((int)65000U/(r/4.0));
			/*
			DDRB=0xff;
			TCCR2 = (1<<WGM21)|(1<<CS20)|(1<<CS21)|(1<<CS22);
			TIMSK = (1<<OCIE2);
			TIFR = (1<<OCF2);
			OCR2=100;
			globalcountertimer0=0;
			timer1_2enable();
   			while(globalcountertimer0<(64/r+1))
				{PORTB=~globalcountertimer0;}
   			timer1_2disable();*/
		}
	   else 
		;

	   if(strlen(temp)>0)
		{
		if(r!=1)
	   	p(temp,r);
		else p(temp,r);
		}
	}
}




const char qianzou[] PROGMEM ="+8o16ga1g8oa16dedc2cc-bag1gg";
const char song[] PROGMEM = "8efg4fg8fed4doo8edc4c+8c4c-8eg4goo8cc4d8cc4o8o+c-4b8a16bag4goc8cc4e8cd4do8oeefgfefgaed2d4o8edc4c8c+cc-eg2g4o8og4a+8cc4c8od-4b8a16bag4g8gga+cccc-a+cd2d8o-g+e16cd8dc-16abag8gg+cdeddcc4c8g2g4o8eggeedeefe2e4o8eddcc-a+4c8d-a2g4o8gga+cccc-a+cd2d8o-g+cded4d8c4c8g2g4o8eggeedeefe2e4o8eddcc-a+ccd-a2g4o8gga+cc-a+edccc2c4ooooo"; 
const char jianzou[] PROGMEM ="++16c-bagga8g4e16-ga+cd8eg16ed8c-baba2a+4f8ga4g8bg+4c8dec-b+4c16--oga+cd8eg16ed8c-baba4a+4f8ga4g8bg+4c8de4d8c-b+4c";
//const char song2[] PROGMEM ="+8oc4c8efedo-a+ccc-a+cc4c8-ag4oo8o+c4ccag8cccceddcc-a+cd2d4o8ocde2e8o-g+cd";
const char song3[] PROGMEM ="+eddcc4c8g2g4o8eggeedeefe2e4o8eddcc-a+4c8d-8a2g4o8gga+8c16c-a8a+c-a+cd2d8o-g+cded4d8c4c8g2g4o8eggeedeefe2e4o8eddcc-a+ccd-a2g4o8gga+cc-a+e16dc8c16cd2c4oo";
const char song4[] PROGMEM ="8gga+cc-a+e16dc8c16cd2c4oo";
const char jiewei[] PROGMEM ="4o16ga+cd8eg16ed8c-gaba4a16+e8f16f4f8ga4g8bg4a8b+c-4b8ag+4c--16oga+cd8eg16ed8c-gaba4a16+e8f16f4f8ga4g8bg+4c8de4d8c=bb+c1c";
const char test[] PROGMEM = "4ooooo";


const char song2[] PROGMEM = "4ccggaagoffeeddc";



void task1(void)
{
	  generator();
	  ini_Ex1();
	  songnumber=1;
	  DDRC=0xff;
  while(1)
 {
	PORTC=~0x18;
	delay(20000U);
	PORTC=0xff;
	if(songnumber==1)
	{
		
		 while(1)
   		{
			if(songnumber!=1)
				break;
			//play(qianzou,4);	
			play(song,4);
			//play(song,4);
			//play(jianzou,4);	
			//play(song2,4);
			//play(song3,4);
			//play(song4,4);
			//play(jiewei,4);
		}
	
	   }
	else if(songnumber==2)
	{
	  while(1)
		{
		   if(songnumber!=2)
			break;
		   play(song2,4);
		}
	}
	else ;
  }
}




void task2(void)
{
DDRB=0x00;  //sw

while(1)
{
  if(PINB==0xfe)
	songnumber=1;
  else if(PINB==0xfd)
	songnumber=2;
  else 
	;//songnumber=songnumber;
UIKDelay(10);
}                                                                                                   

}




void UIKIdle()
{
while(1)
{
DDRC=0xff;
PORTC=~0x81;
	delay(20000U);
	PORTC=0xff;
UIKDelay(10);
}
}

//**********************************************************************************/

int main()
{     



	UIKInitialize(8,10);//8 64 256 1024

	UIKAddTask(UIKIdle,0,1);	
	UIKAddTask(task1,1,1);	
	UIKAddTask(task2,2,0);		
	//UIKAddTask(task3,3,0);
	
	numberofRunningTask = 3;

	UIKRun( 0 );
	UIKRun( 1 );
	UIKRun( 2 );
	//UIKRun( 3 );

	sei(); 
	start();

	while (1) ;
} 








